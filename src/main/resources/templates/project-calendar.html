<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>路演日历</title>
    <!-- 引入样式文件 -->
    <link
            rel="stylesheet"
            href="../static/vant.css"
    />
    <!-- 引入 Vue 和 Vant 的 JS 文件 -->
    <script src="../static/vue@3.js"></script>
    <script src="../static/vant.min.js"></script>
    <!--
    href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css"
    <script src="https://fastly.jsdelivr.net/npm/vue@3"></script>
    <script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>
    -->
    <style>

    </style>
</head>
<body>
<div id="app">
    <div id="meeting-cale">
        <van-calendar
                title="路演日历"
                switch-mode="month"
                :min-date="minDate"
                :formatter="formatter"
                :poppable="false"
                :show-confirm="false"
                height="500"
                @select="selectDate"
                @panel-change="showMonth"
        />
    </div>
    <div>
        <van-divider>今日会议</van-divider>
    </div>
    <div id="meetings">
        <van-cell v-for="item in dateMeetings" :title="getMeetingName(item)" is-link icon="service" :url="getUrl(item.id)"/>
    </div>
</div>
<script>
    const app = Vue.createApp({
        data() {
            return {
                minDate:null,
                show:true,
                monthMeetings:[],
                flag: false,
                dateMeetings:[]
            }
        },
        created() {
            let date = new Date()
            this.minDate = new Date(date.getFullYear(),date.getMonth(),date.getDate());
            this.showMonth(date)
            this.selectDate(date)
        },
        methods: {
            selectDate(date) {
                console.log("selectDate date===",date)
                let day = date.getDate()
                this.dateMeetings =  this.monthMeetings.filter(item => new Date(item.startTime).getDate() === day)
            },
            showMonth(data) {
                this.flag = false
                let date = data.date
                if (date == null) {
                    date = data
                }
                // fetch("/wx/getMonthMeetings?date="+ date)
                //     .then(res => res.json())
                //     .then(json => this.monthMeetings = json)
                //     .catch(err => console.log(err))
                this.monthMeetings = [
                    {"id":1,"startTime":'2024-06-02 12:34:55',"name":"会议1"},
                    {"id":2,"startTime":'2024-06-08 12:34:55', "name": "会议2"},
                    {"id":3,"startTime":'2024-06-24 12:34:55', "name": "会议3"},
                    {"id":4,"startTime":'2024-06-24 14:34:55', "name": "会议4"},
                    {"id":5,"startTime":'2024-06-29 12:34:55', "name": "会议5"}
                ]
                this.flag = true
            }
        },
        computed: {
            getMeetingName() {
                return (item) => {
                    return item.name + "(" + item.startTime.split(" ")[1] + ")"
                }
            },
            getUrl() {
              return (id) => {
                  return "/wx/meeting?id=" + id
              }
            },
            formatter() {
                return (day) => {
                    if (!this.flag) {
                        this.showMonth(day)
                    }
                    let date = day.date.getDate();
                    if ( day.date >= this.minDate &&
                        this.monthMeetings.filter(item => new Date(item.startTime).getDate() === date).length > 0) {
                        day.bottomInfo = '●'
                    }
                    return day;
                };
            }
        }
    })
    // 通过 CDN 引入时不会自动注册 Lazyload 组件
    // 可以通过下面的方式手动注册
    app.use(vant.Lazyload);
    app.use(vant.Calendar);
    app.use(vant.Cell);
    app.use(vant.Divider)
    app.mount('#app');
</script>
</body>
</html>